#!/bin/bash
# Installs uv tools when config changes
# Hash: {{ include "dot_config/uv/tools.txt" | sha256sum }}

set -euo pipefail

echo "Installing uv tools..."

# Add mise to PATH
export PATH="${HOME}/.local/bin:${PATH}"

# Check if mise is available
if ! command -v mise &> /dev/null; then
    echo "mise not found, skipping uv tools installation"
    exit 0
fi

# Check if uv works via mise exec
if ! mise exec -- uv --version &> /dev/null; then
    echo "uv not available via mise, skipping uv tools installation"
    exit 0
fi

# Read tools.txt and install each tool using mise exec
while IFS= read -r line || [[ -n "$line" ]]; do
    # Skip empty lines and comments
    [[ -z "$line" || "$line" =~ ^[[:space:]]*# ]] && continue

    # Trim whitespace
    tool=$(echo "$line" | xargs)

    echo "Installing $tool..."
    mise exec -- uv tool install "$tool" --force
done < "${HOME}/.config/uv/tools.txt"

echo "uv tools installed successfully!"
